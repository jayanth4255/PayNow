{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - PayNow{% endblock %}

{% block content %}
<div class="futuristic-bg"></div>

<div class="container py-8">
    <!-- Header with Greeting -->
    <div class="dashboard-header animate-slide-up">
        <div>
            <h1 class="greeting">Good {% now "A" %}, {{ name }}!</h1>
            <p class="text-muted">Welcome to your financial command center</p>
        </div>
        <div class="profile-quick-actions">
            <button class="icon-btn" onclick="window.location.href='{% url 'transaction_history' %}'">
                <i class="ri-history-line"></i>
            </button>
            <button class="icon-btn" onclick="window.location.href='{% url 'logout' %}'">
                <i class="ri-logout-box-line"></i>
            </button>
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div class="dashboard-grid">

        <!-- Left Column: Profile & Wallet -->
        <div class="left-column">

            <!-- Enhanced Profile Card -->
            <div class="profile-card glass-card animate-slide-up" style="animation-delay: 0.1s;">
                <div class="profile-header">
                    <div class="avatar-large">
                        <div class="avatar-glow"></div>
                        <span>{{ initial }}</span>
                    </div>
                    <div class="profile-info">
                        <h3>{{ name }}</h3>
                        <p class="text-muted">{{ phone }}</p>
                        <div class="verification-badge">
                            <i class="ri-verified-badge-fill"></i> Verified
                        </div>
                    </div>
                </div>

                <div class="profile-details">
                    <div class="detail-item">
                        <i class="ri-mail-line"></i>
                        <div>
                            <span class="label">Email</span>
                            <span class="value">{{ email|default:"Not set" }}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="ri-bank-card-line"></i>
                        <div>
                            <span class="label">Account</span>
                            <span class="value font-mono">•••• {{ account_number|slice:"-4:" }}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="ri-bank-line"></i>
                        <div>
                            <span class="label">Bank</span>
                            <span class="value">{{ bank_name }}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="ri-shield-check-line"></i>
                        <div>
                            <span class="label">Aadhaar</span>
                            <span class="value font-mono">•••• {{ aadhaar|slice:"-4:" }}</span>
                        </div>
                    </div>
                </div>

                <div class="upi-section">
                    <div class="upi-label">Your UPI ID</div>
                    <div class="upi-id">
                        <span id="upiText">{{ upi_id }}</span>
                        <button class="copy-btn" onclick="copyUPI()">
                            <i class="ri-file-copy-line"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Futuristic Wallet Card -->
            <div class="wallet-card glass-card animate-slide-up" style="animation-delay: 0.2s;">
                <div class="wallet-bg-pattern"></div>
                <div class="wallet-content">
                    <div class="wallet-header">
                        <span class="wallet-label">Total Balance</span>
                        <button class="balance-toggle" onclick="toggleBalance()">
                            <i class="ri-eye-line" id="eyeIcon"></i>
                        </button>
                    </div>
                    <h1 class="balance-amount" id="balanceDisplay">
                        <span class="currency">₹</span>
                        <span id="balanceValue">****.**</span>
                    </h1>
                    <div class="wallet-footer">
                        <div class="wallet-chip">
                            <i class="ri-bank-card-fill"></i>
                            {{ bank_name }}
                        </div>
                        <button class="qr-btn" onclick="window.location.href='{% url 'upi-scan' %}'">
                            <i class="ri-qr-code-line"></i>
                        </button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Right Column: Stats & Actions -->
        <div class="right-column">

            <!-- Quick Stats Grid -->
            <div class="stats-grid animate-slide-up" style="animation-delay: 0.3s;">
                <div class="stat-card">
                    <div class="stat-icon bg-blue">
                        <i class="ri-arrow-up-line"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Sent This Month</span>
                        <span class="stat-value">₹{{ total_sent|floatformat:2 }}</span>
                        <span class="stat-sub">{{ sent_count }} transactions</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-green">
                        <i class="ri-arrow-down-line"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Received</span>
                        <span class="stat-value">₹{{ total_received|floatformat:2 }}</span>
                        <span class="stat-sub">{{ received_count }} transactions</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-purple">
                        <i class="ri-exchange-line"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Total Transactions</span>
                        <span class="stat-value">{{ total_transactions_month }}</span>
                        <span class="stat-sub">This month</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-orange">
                        <i class="ri-bar-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Average</span>
                        <span class="stat-value">₹{{ avg_transaction|floatformat:2 }}</span>
                        <span class="stat-sub">Per transaction</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="action-section glass-card animate-slide-up" style="animation-delay: 0.4s;">
                <h4 class="section-title">Quick Actions</h4>
                <div class="action-grid">
                    <a href="{% url 'upi-scan' %}" class="action-btn">
                        <div class="action-icon bg-gradient-blue">
                            <i class="ri-qr-scan-2-line"></i>
                        </div>
                        <span>Scan QR</span>
                    </a>
                    <a href="{% url 'transfer_money' %}" class="action-btn">
                        <div class="action-icon bg-gradient-purple">
                            <i class="ri-send-plane-fill"></i>
                        </div>
                        <span>Send Money</span>
                    </a>
                    <a href="{% url 'mobile_recharge' %}" class="action-btn">
                        <div class="action-icon bg-gradient-green">
                            <i class="ri-smartphone-line"></i>
                        </div>
                        <span>Recharge</span>
                    </a>
                    <a href="{% url 'electricity_bill' %}" class="action-btn">
                        <div class="action-icon bg-gradient-orange">
                            <i class="ri-lightbulb-flash-line"></i>
                        </div>
                        <span>Pay Bills</span>
                    </a>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="transactions-section glass-card animate-slide-up" style="animation-delay: 0.5s;">
                <div class="section-header">
                    <h4 class="section-title">Recent Activity</h4>
                    <a href="{% url 'transaction_history' %}" class="view-all-link">View All <i
                            class="ri-arrow-right-line"></i></a>
                </div>

                {% if recent_transactions %}
                <div class="transaction-list">
                    {% for t in recent_transactions %}
                    <div class="transaction-item">
                        <div
                            class="transaction-icon {% if t.sender_phone_number == logged_in_phone %}sent{% else %}received{% endif %}">
                            <i
                                class="{% if t.sender_phone_number == logged_in_phone %}ri-arrow-right-up-line{% else %}ri-arrow-left-down-line{% endif %}"></i>
                        </div>
                        <div class="transaction-details">
                            <span class="transaction-name">
                                {% if t.sender_phone_number == logged_in_phone %}
                                {{ t.receiver_name|default:t.receiver_phone_number }}
                                {% else %}
                                {{ t.sender_name|default:t.sender_phone_number }}
                                {% endif %}
                            </span>
                            <span class="transaction-date">{{ t.transaction_date|date:"M d, h:i A" }}</span>
                        </div>
                        <div
                            class="transaction-amount {% if t.sender_phone_number == logged_in_phone %}sent{% else %}received{% endif %}">
                            {% if t.sender_phone_number == logged_in_phone %}- {% else %}+ {% endif %}₹{{
                            t.transaction_amount }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="ri-inbox-line"></i>
                    <p>No recent transactions</p>
                </div>
                {% endif %}
            </div>

        </div>
    </div>
</div>

<script>
    let balanceVisible = false;
    const actualBalance = "{{ balance }}";

    function toggleBalance() {
        const balanceValue = document.getElementById('balanceValue');
        const eyeIcon = document.getElementById('eyeIcon');

        balanceVisible = !balanceVisible;

        if (balanceVisible) {
            balanceValue.textContent = parseFloat(actualBalance).toFixed(2);
            eyeIcon.className = 'ri-eye-off-line';
        } else {
            balanceValue.textContent = '****.**';
            eyeIcon.className = 'ri-eye-line';
        }
    }

    function copyUPI() {
        const upiText = document.getElementById('upiText').textContent;
        navigator.clipboard.writeText(upiText).then(() => {
            alert('UPI ID copied to clipboard!');
        });
    }
</script>

<style>
    /* Futuristic Background */
    .futuristic-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #F8F9FA 0%, #E8F0FE 100%);
        z-index: -1;
    }

    .futuristic-bg::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 800px;
        height: 800px;
        background: radial-gradient(circle, rgba(0, 102, 255, 0.1) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 20s ease-in-out infinite;
    }

    @keyframes float {

        0%,
        100% {
            transform: translate(0, 0);
        }

        50% {
            transform: translate(-50px, -50px);
        }
    }

    /* Dashboard Header */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .greeting {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.25rem;
    }

    .profile-quick-actions {
        display: flex;
        gap: 0.5rem;
    }

    .icon-btn {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: white;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--text-main);
        cursor: pointer;
        transition: all 0.3s;
    }

    .icon-btn:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 102, 255, 0.2);
    }

    /* Dashboard Grid */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 400px 1fr;
        gap: 2rem;
    }

    /* Glass Card Effect */
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        padding: 2rem;
        transition: all 0.3s;
    }

    .glass-card:hover {
        box-shadow: 0 12px 48px rgba(0, 0, 0, 0.1);
        transform: translateY(-4px);
    }

    /* Profile Card */
    .profile-card {
        margin-bottom: 1.5rem;
    }

    .profile-header {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid var(--border);
    }

    .avatar-large {
        position: relative;
        width: 80px;
        height: 80px;
        border-radius: 20px;
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
    }

    .avatar-glow {
        position: absolute;
        inset: -4px;
        border-radius: 24px;
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
        opacity: 0.3;
        filter: blur(12px);
        z-index: -1;
        animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 0.3;
        }

        50% {
            opacity: 0.6;
        }
    }

    .profile-info h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .verification-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.75rem;
        background: #ECFDF5;
        color: #10B981;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-top: 0.5rem;
    }

    .profile-details {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .detail-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .detail-item i {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: var(--background);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--primary);
    }

    .detail-item .label {
        display: block;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 0.125rem;
    }

    .detail-item .value {
        display: block;
        font-weight: 600;
        color: var(--text-main);
    }

    .upi-section {
        background: var(--background);
        padding: 1rem;
        border-radius: 12px;
    }

    .upi-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .upi-id {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-family: monospace;
        font-weight: 600;
        color: var(--primary);
    }

    .copy-btn {
        background: white;
        border: 1px solid var(--border);
        border-radius: 8px;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .copy-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    /* Wallet Card */
    .wallet-card {
        position: relative;
        overflow: hidden;
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
        color: white;
    }

    .wallet-bg-pattern {
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        border-radius: 50%;
    }

    .wallet-content {
        position: relative;
        z-index: 1;
    }

    .wallet-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .wallet-label {
        font-size: 0.875rem;
        opacity: 0.9;
    }

    .balance-toggle {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .balance-toggle:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .balance-amount {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        letter-spacing: -0.02em;
    }

    .currency {
        font-size: 2rem;
        opacity: 0.8;
    }

    .wallet-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .wallet-chip {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .qr-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .qr-btn:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        display: flex;
        gap: 1rem;
        border: 1px solid var(--border);
        transition: all 0.3s;
    }

    .stat-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }

    .bg-blue {
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
    }

    .bg-green {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    }

    .bg-purple {
        background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    }

    .bg-orange {
        background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
    }

    .stat-content {
        display: flex;
        flex-direction: column;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 0.25rem;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-main);
        margin-bottom: 0.125rem;
    }

    .stat-sub {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    /* Action Section */
    .action-section {
        margin-bottom: 1.5rem;
    }

    .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .action-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }

    .action-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border-radius: 12px;
        background: var(--background);
        transition: all 0.3s;
        text-decoration: none;
        color: var(--text-main);
    }

    .action-btn:hover {
        background: white;
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
    }

    .action-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .bg-gradient-blue {
        background: linear-gradient(135deg, #0066FF 0%, #0044AA 100%);
    }

    .bg-gradient-purple {
        background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
    }

    .bg-gradient-green {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    }

    .bg-gradient-orange {
        background: linear-gradient(135deg, #F97316 0%, #EA580C 100%);
    }

    .action-btn span {
        font-size: 0.875rem;
        font-weight: 500;
    }

    /* Transactions Section */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .view-all-link {
        font-size: 0.875rem;
        color: var(--primary);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-weight: 500;
    }

    .view-all-link:hover {
        gap: 0.5rem;
    }

    .transaction-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .transaction-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--background);
        border-radius: 12px;
        transition: all 0.2s;
    }

    .transaction-item:hover {
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .transaction-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.125rem;
        flex-shrink: 0;
    }

    .transaction-icon.sent {
        background: #FEF2F2;
        color: #EF4444;
    }

    .transaction-icon.received {
        background: #ECFDF5;
        color: #10B981;
    }

    .transaction-details {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .transaction-name {
        font-weight: 600;
        color: var(--text-main);
    }

    .transaction-date {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .transaction-amount {
        font-weight: 700;
        font-size: 1.125rem;
    }

    .transaction-amount.sent {
        color: var(--text-main);
    }

    .transaction-amount.received {
        color: #10B981;
    }

    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .action-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    @media (max-width: 640px) {
        .greeting {
            font-size: 1.5rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .action-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .balance-amount {
            font-size: 2.5rem;
        }
    }
</style>
{% endblock %}